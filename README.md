# AI Text Reranking System - æ™ºè°±GLMæ–‡æœ¬é‡æ’åºç³»ç»Ÿ

åŸºäºæ™ºè°±AI GLMé‡æ’åºæ¨¡å‹çš„é«˜è´¨é‡æ–‡æœ¬é‡æ’åºç³»ç»Ÿï¼Œå¯¹å€™é€‰æ–‡æ¡£è¿›è¡Œç›¸å…³æ€§æ’åºï¼Œç”¨äºä¿¡æ¯æ£€ç´¢å’Œæ–‡æ¡£æ’åºã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ”„ **æ–‡æ¡£é‡æ’åº**: åŸºäºæ™ºè°±GLMé‡æ’åºæ¨¡å‹
- ğŸ† **æœ€ç›¸å…³æ–‡æ¡£**: è·å–ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„å‰Nä¸ªæ–‡æ¡£
- ğŸ¯ **é˜ˆå€¼ç­›é€‰**: æ ¹æ®ç›¸å…³æ€§é˜ˆå€¼ç­›é€‰ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£
- ğŸŒ **Webç•Œé¢**: ç°ä»£åŒ–çš„å“åº”å¼Webç•Œé¢
- ğŸ”Œ **MCPæœåŠ¡å™¨**: æ”¯æŒModel Context Protocol
- ğŸ“¦ **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡æ–‡æ¡£é‡æ’åº
- ğŸ’¾ **æ•°æ®å¯¼å‡º**: æ”¯æŒé‡æ’åºç»“æœçš„ä¿å­˜å’ŒåŠ è½½
- ğŸ§ª **APIæµ‹è¯•**: å†…ç½®APIè¿æ¥æµ‹è¯•åŠŸèƒ½

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- æ™ºè°±AI APIå¯†é’¥

### å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨uvå®‰è£…ä¾èµ–ï¼ˆæ¨èï¼‰
uv sync

# æˆ–ä½¿ç”¨pipå®‰è£…
pip install -r requirements.txt
```

### é…ç½®APIå¯†é’¥

åˆ›å»º `config.json` æ–‡ä»¶ï¼š

```json
{
  "zhipu_api_key": "your_zhipu_api_key_here"
}
```

æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export ZHIPU_API_KEY="your_zhipu_api_key_here"
```

### MCPé…ç½®
```json
{
  "mcpServers":{
    "mcp-text-reranking": {
      "disabled": false,
      "timeout": 60,
      "type": "sse",
      "url": "http://127.0.0.1:8000/sse"
    }
  }
}
```

### è¿è¡Œæ–¹å¼

#### 1. Webç•Œé¢æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
python rerank_server.py
```

ç„¶åè®¿é—® http://localhost:5000

#### 2. äº¤äº’å¼å‘½ä»¤è¡Œæ¨¡å¼

```bash
python main_rerank.py
```

#### 3. MCPæœåŠ¡å™¨æ¨¡å¼

```bash
python main_rerank.py --mcp
```

## ğŸ¯ æ”¯æŒçš„æ¨¡å‹

| æ¨¡å‹ | æè¿° | ç‰¹ç‚¹ |
|------|------|------|
| rerank | æ™ºè°±AIæ–‡æœ¬é‡æ’åºæ¨¡å‹ | é«˜è´¨é‡æ–‡æ¡£ç›¸å…³æ€§æ’åºï¼Œæ¨èä½¿ç”¨ |

## ğŸ”„ ä¸»è¦åŠŸèƒ½

- **æ–‡æ¡£é‡æ’åº** - æ ¹æ®æŸ¥è¯¢æ–‡æœ¬å¯¹å€™é€‰æ–‡æ¡£è¿›è¡Œç›¸å…³æ€§æ’åº
- **æœ€ç›¸å…³æ–‡æ¡£è·å–** - è·å–ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„å‰Nä¸ªæ–‡æ¡£
- **é˜ˆå€¼ç­›é€‰** - æ ¹æ®ç›¸å…³æ€§é˜ˆå€¼ç­›é€‰ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£
- **APIæµ‹è¯•** - æµ‹è¯•æ™ºè°±AIé‡æ’åºAPIçš„è¿æ¥çŠ¶æ€

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### Python APIè°ƒç”¨

```python
from zhipu_rerank_client import ZhipuRerankClient

# åˆå§‹åŒ–å®¢æˆ·ç«¯
client = ZhipuRerankClient(api_key="your_api_key")

# æ–‡æ¡£é‡æ’åº
query = "äººå·¥æ™ºèƒ½çš„å‘å±•å†å²"
documents = [
    "äººå·¥æ™ºèƒ½èµ·æºäº20ä¸–çºª50å¹´ä»£ï¼Œç”±å›¾çµç­‰ç§‘å­¦å®¶å¥ å®šåŸºç¡€",
    "ä»Šå¤©çš„å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå‡ºé—¨æ•£æ­¥",
    "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„é‡è¦åˆ†æ”¯",
    "æ·±åº¦å­¦ä¹ åœ¨è¿‘å¹´æ¥å–å¾—äº†çªç ´æ€§è¿›å±•"
]

result = client.rerank(
    query=query,
    documents=documents,
    model="rerank"
)

print("é‡æ’åºç»“æœ:")
for i, item in enumerate(result["results"]):
    print(f"{i+1}. {item['document']} (ç›¸å…³æ€§: {item['relevance_score']:.4f})")
```

### è·å–æœ€ç›¸å…³æ–‡æ¡£

```python
# è·å–å‰3ä¸ªæœ€ç›¸å…³çš„æ–‡æ¡£
top_docs = client.get_ranked_documents(
    query=query,
    documents=documents,
    model="rerank",
    top_k=3
)

print("æœ€ç›¸å…³çš„æ–‡æ¡£:")
for i, doc in enumerate(top_docs):
    print(f"{i+1}. {doc['document']} (ç›¸å…³æ€§: {doc['relevance_score']:.4f})")
```

### é˜ˆå€¼ç­›é€‰

```python
# ç­›é€‰ç›¸å…³æ€§è¶…è¿‡0.7çš„æ–‡æ¡£
relevant_docs = client.find_most_relevant(
    query=query,
    documents=documents,
    model="rerank",
    threshold=0.7
)

print(f"æ‰¾åˆ° {len(relevant_docs)} ä¸ªé«˜ç›¸å…³æ€§æ–‡æ¡£")
```

### MCPå·¥å…·è°ƒç”¨

```python
# æ–‡æ¡£é‡æ’åº
rerank_documents(
    query="æŸ¥è¯¢æ–‡æœ¬",
    documents=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    model="rerank"
)

# è·å–æœ€ç›¸å…³æ–‡æ¡£
get_top_relevant_documents(
    query="æŸ¥è¯¢æ–‡æœ¬",
    documents=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    top_k=5
)

# é˜ˆå€¼ç­›é€‰
find_relevant_documents(
    query="æŸ¥è¯¢æ–‡æœ¬",
    documents=["æ–‡æ¡£1", "æ–‡æ¡£2", "æ–‡æ¡£3"],
    threshold=0.5
)

# æµ‹è¯•APIè¿æ¥
test_rerank_api("æµ‹è¯•æŸ¥è¯¢", ["æµ‹è¯•æ–‡æ¡£"])
```

## ğŸŒ Webç•Œé¢åŠŸèƒ½

- **æ–‡æ¡£é‡æ’åº**: è¾“å…¥æŸ¥è¯¢å’Œå€™é€‰æ–‡æ¡£ï¼Œè·å¾—æ’åºç»“æœ
- **æœ€ç›¸å…³æ–‡æ¡£**: è·å–å‰Nä¸ªæœ€ç›¸å…³çš„æ–‡æ¡£
- **é˜ˆå€¼ç­›é€‰**: æ ¹æ®ç›¸å…³æ€§é˜ˆå€¼ç­›é€‰æ–‡æ¡£
- **APIæµ‹è¯•**: æµ‹è¯•APIè¿æ¥çŠ¶æ€å’ŒåŠŸèƒ½
- **å®æ—¶çŠ¶æ€ç›‘æ§**: æ˜¾ç¤ºAPIè¿æ¥çŠ¶æ€
- **ç»“æœå¯è§†åŒ–**: ç›¸å…³æ€§åˆ†æ•°æ¡å½¢å›¾æ˜¾ç¤º
- **ä¸‹è½½åŠŸèƒ½**: ä¸€é”®ä¸‹è½½é‡æ’åºç»“æœ

## ğŸ“ é¡¹ç›®ç»“æ„

```
AI-Text-Reranking/
â”œâ”€â”€ main_rerank.py          # é‡æ’åºä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ zhipu_rerank_client.py  # æ™ºè°±é‡æ’åºå®¢æˆ·ç«¯
â”œâ”€â”€ rerank_server.py        # WebæœåŠ¡å™¨
â”œâ”€â”€ rerank_interface.html   # Webç•Œé¢
â”œâ”€â”€ network_diagnostic.py   # ç½‘ç»œè¯Šæ–­å·¥å…·
â”œâ”€â”€ config.json            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ outputs/               # è¾“å‡ºç›®å½•
â””â”€â”€ docs/                  # æ–‡æ¡£ç›®å½•
```

## ğŸ”§ é…ç½®é€‰é¡¹

### APIé…ç½®

```json
{
  "zhipu_api_key": "your_api_key",
  "text_rerank": {
    "base_url": "https://open.bigmodel.cn",
    "timeout": 30,
    "max_retries": 3
  }
}
```

### é‡æ’åºå‚æ•°

- **query**: æŸ¥è¯¢æ–‡æœ¬ï¼ˆå¿…éœ€ï¼‰
- **documents**: å€™é€‰æ–‡æ¡£åˆ—è¡¨ï¼ˆå¿…éœ€ï¼‰
- **model**: é‡æ’åºæ¨¡å‹ï¼ˆé»˜è®¤: rerankï¼‰

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `zhipu_rerank_client.py` ä¸­æ·»åŠ æ–°çš„APIæ–¹æ³•
2. åœ¨ `main_rerank.py` ä¸­æ·»åŠ å¯¹åº”çš„MCPå·¥å…·
3. åœ¨ `rerank_server.py` ä¸­æ·»åŠ Web APIæ¥å£
4. æ›´æ–°Webç•Œé¢æ·»åŠ æ–°åŠŸèƒ½

### è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼

```python
# ä¿®æ”¹ä¿å­˜æ ¼å¼
def save_custom_format(self, rerank_data, filename, format="json"):
    # è‡ªå®šä¹‰ä¿å­˜é€»è¾‘
    pass
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIå¯†é’¥é”™è¯¯**
   - æ£€æŸ¥config.jsonä¸­çš„APIå¯†é’¥
   - ç¡®è®¤ç¯å¢ƒå˜é‡ZHIPU_API_KEYè®¾ç½®æ­£ç¡®

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - è¿è¡Œç½‘ç»œè¯Šæ–­: `python network_diagnostic.py`
   - æ£€æŸ¥é˜²ç«å¢™å’Œä»£ç†è®¾ç½®

3. **é‡æ’åºå¤±è´¥**
   - æ£€æŸ¥æŸ¥è¯¢æ–‡æœ¬å’Œæ–‡æ¡£æ˜¯å¦ä¸ºç©º
   - ç¡®è®¤æ–‡æ¡£æ•°é‡ä¸è¶…è¿‡APIé™åˆ¶
   - å°è¯•ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢æ–‡æœ¬

4. **Webç•Œé¢æ— æ³•è®¿é—®**
   - ç¡®è®¤ç«¯å£5000æœªè¢«å ç”¨
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=DEBUG
python main_rerank.py
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- åˆç†æ§åˆ¶å€™é€‰æ–‡æ¡£æ•°é‡ï¼ˆå»ºè®®ä¸è¶…è¿‡100ä¸ªï¼‰
- ä½¿ç”¨ç®€æ´æ˜ç¡®çš„æŸ¥è¯¢æ–‡æœ¬
- æ‰¹é‡å¤„ç†æ—¶é€‚å½“å¢åŠ å»¶è¿Ÿé¿å…APIé™åˆ¶
- æ ¹æ®éœ€æ±‚è®¾ç½®åˆé€‚çš„ç›¸å…³æ€§é˜ˆå€¼

## ğŸ”Œ APIæ¥å£

### RESTful API

- `POST /api/rerank` - æ–‡æ¡£é‡æ’åº
- `POST /api/top_relevant` - è·å–æœ€ç›¸å…³æ–‡æ¡£
- `POST /api/relevant_by_threshold` - æŒ‰é˜ˆå€¼ç­›é€‰ç›¸å…³æ–‡æ¡£
- `GET /api/models` - è·å–æ”¯æŒçš„æ¨¡å‹
- `POST /api/test` - æµ‹è¯•APIè¿æ¥
- `GET /api/status` - è·å–æœåŠ¡çŠ¶æ€

### MCPå·¥å…·

- `rerank_documents` - æ–‡æ¡£é‡æ’åº
- `get_top_relevant_documents` - è·å–æœ€ç›¸å…³æ–‡æ¡£
- `find_relevant_documents` - æŸ¥æ‰¾ç›¸å…³æ–‡æ¡£
- `get_supported_rerank_models` - è·å–æ”¯æŒçš„æ¨¡å‹
- `test_rerank_api` - æµ‹è¯•APIè¿æ¥
- `save_rerank_results_to_file` - ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
- `load_rerank_results_from_file` - ä»æ–‡ä»¶åŠ è½½ç»“æœ

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- æ™ºè°±AIæä¾›çš„Rerankæ¨¡å‹
- Flaskå’Œç›¸å…³Webæ¡†æ¶
- æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ–‡æ¡£å’ŒFAQ
2. æäº¤Issue
3. è”ç³»å¼€å‘å›¢é˜Ÿ

---

**äº«å—AIæ–‡æœ¬é‡æ’åºçš„ä¾¿åˆ©ï¼** ğŸ”„âœ¨