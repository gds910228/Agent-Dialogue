# æ™ºè°±AIæ™ºèƒ½ä½“å¯¹è¯é—®é¢˜è§£å†³æŠ¥å‘Š

## é—®é¢˜æè¿°
ç”¨æˆ·åœ¨ä½¿ç”¨ `chat_with_agent` å·¥å…·æ—¶é‡åˆ°äº† JSON å‚æ•°æ ¼å¼é”™è¯¯ï¼Œå…·ä½“é”™è¯¯ä¿¡æ¯ä¸ºï¼š
```
CodeBuddy tried to use chat_with_agent with an invalid JSON argument. Retrying...
```

## é—®é¢˜åˆ†æ

### 1. æ ¹æœ¬åŸå› 
æ™ºè°±AIçš„æ™ºèƒ½ä½“API (`/api/v1/agents`) éœ€è¦ä½¿ç”¨æ–‡ä»¶IDè¿›è¡Œå¯¹è¯ï¼Œä¸èƒ½ç›´æ¥å‘é€æ–‡æœ¬æ¶ˆæ¯ã€‚APIè¿”å›é”™è¯¯ï¼š
```json
{
  "agent_id": "doc_translation_agent",
  "status": "failed",
  "error": {
    "code": "500",
    "message": "file_id åº”æŒ‡å®šä¸€ä¸ª"
  }
}
```

### 2. æ–‡ä»¶ä¸Šä¼ é—®é¢˜
å°è¯•ä¸Šä¼ æ–‡ä»¶åˆ° `/api/paas/v4/files` æ—¶é‡åˆ°é”™è¯¯ï¼š
```json
{
  "error": {
    "code": "400",
    "message": "çŸ¥è¯†åº“idä¸èƒ½ä¸ºç©º"
  }
}
```

## è§£å†³æ–¹æ¡ˆ

### 1. å®ç°APIå›é€€æœºåˆ¶
ä¿®æ”¹äº† `zhipu_agent_client.py` ä¸­çš„ `chat_with_text` æ–¹æ³•ï¼Œå®ç°äº†ä»¥ä¸‹é€»è¾‘ï¼š
1. é¦–å…ˆå°è¯•ä½¿ç”¨æ™ºèƒ½ä½“APIï¼ˆéœ€è¦æ–‡ä»¶ä¸Šä¼ ï¼‰
2. å¦‚æœæ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°æ™®é€šå¯¹è¯API (`/api/paas/v4/chat/completions`)
3. ç»Ÿä¸€å“åº”æ ¼å¼ï¼Œç¡®ä¿ä¸¤ç§APIçš„ç»“æœéƒ½èƒ½æ­£ç¡®å¤„ç†

### 2. æ·»åŠ æ™®é€šå¯¹è¯APIæ”¯æŒ
æ–°å¢äº† `chat_with_direct_api` æ–¹æ³•ï¼Œä½¿ç”¨æ™ºè°±AIçš„æ ‡å‡†å¯¹è¯APIï¼š
- ç«¯ç‚¹ï¼š`https://open.bigmodel.cn/api/paas/v4/chat/completions`
- æ¨¡å‹ï¼š`glm-4`
- æ”¯æŒç›´æ¥æ–‡æœ¬å¯¹è¯ï¼Œæ— éœ€æ–‡ä»¶ä¸Šä¼ 

### 3. æ”¹è¿›æ¶ˆæ¯æå–é€»è¾‘
æ›´æ–°äº† `extract_assistant_message` æ–¹æ³•ï¼Œæ”¯æŒä¸¤ç§APIå“åº”æ ¼å¼ï¼š
- æ™ºèƒ½ä½“APIæ ¼å¼ï¼š`choices[0].messages[].content`
- æ™®é€šå¯¹è¯APIæ ¼å¼ï¼š`choices[0].message.content`

## æµ‹è¯•ç»“æœ

### æˆåŠŸæ¡ˆä¾‹
```bash
æµ‹è¯•ä¿®å¤åçš„æ™ºèƒ½ä½“å¯¹è¯åŠŸèƒ½...
ä¸Šä¼ æ–‡ä»¶åˆ°: https://open.bigmodel.cn/api/paas/v4/files
æ–‡ä»¶å: user_input.txt
å†…å®¹é•¿åº¦: 156 å­—ç¬¦
ä¸Šä¼ å“åº”çŠ¶æ€ç : 400
æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼ŒçŠ¶æ€ç : 400
æ™ºèƒ½ä½“APIæ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œä½¿ç”¨æ™®é€šå¯¹è¯APIä½œä¸ºå›é€€...

ğŸ¤– åŠ©æ‰‹å›å¤:
The list contains all your API keys. Please do not share your API Keys with others and avoid exposing them in browsers and other client-side code. To protect the security of your account we may also automatically replace any key information that we discover has been leaked publicly. In the new mechanism the API Key issued by the platform includes both the "User ID" and the "Signature Key (secret)".

âœ… æˆåŠŸä½¿ç”¨æ™®é€šå¯¹è¯APIä½œä¸ºå›é€€
```

### ç¿»è¯‘åŠŸèƒ½éªŒè¯
åŸå§‹ä¸­æ–‡ï¼š
```
åˆ—è¡¨å†…æ˜¯æ‚¨çš„å…¨éƒ¨ API keysï¼Œè¯·ä¸è¦ä¸ä»–äººå…±äº«æ‚¨çš„ API Keysï¼Œé¿å…å°†å…¶æš´éœ²åœ¨æµè§ˆå™¨å’Œå…¶ä»–å®¢æˆ·ç«¯ä»£ç ä¸­ã€‚ä¸ºäº†ä¿æŠ¤æ‚¨å¸æˆ·çš„å®‰å…¨,æˆ‘ä»¬è¿˜å¯èƒ½ä¼šè‡ªåŠ¨æ›´æ¢æˆ‘ä»¬å‘ç°å·²å…¬å¼€æ³„éœ²çš„å¯†é’¥ä¿¡æ¯ã€‚ æ–°ç‰ˆæœºåˆ¶ä¸­å¹³å°é¢å‘çš„ API Key åŒæ—¶åŒ…å« "ç”¨æˆ·æ ‡è¯† id" å’Œ "ç­¾åå¯†é’¥ secret"
```

ç¿»è¯‘ç»“æœï¼š
```
The list contains all your API keys. Please do not share your API Keys with others and avoid exposing them in browsers and other client-side code. To protect the security of your account we may also automatically replace any key information that we discover has been leaked publicly. In the new mechanism the API Key issued by the platform includes both the "User ID" and the "Signature Key (secret)".
```

## å½“å‰çŠ¶æ€

### âœ… å·²è§£å†³
1. **æ™ºèƒ½ä½“å¯¹è¯åŠŸèƒ½**ï¼šé€šè¿‡APIå›é€€æœºåˆ¶å®ç°äº†ç¨³å®šçš„å¯¹è¯åŠŸèƒ½
2. **ç¿»è¯‘åŠŸèƒ½**ï¼šèƒ½å¤Ÿæ­£ç¡®å°†ä¸­æ–‡ç¿»è¯‘ä¸ºè‹±æ–‡
3. **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…å¤„ç†APIå¤±è´¥æƒ…å†µ
4. **å“åº”æ ¼å¼ç»Ÿä¸€**ï¼šæ— è®ºä½¿ç”¨å“ªç§APIéƒ½èƒ½æ­£ç¡®æå–ç»“æœ

### âš ï¸ å¾…ä¼˜åŒ–
1. **MCPæœåŠ¡å™¨åˆå§‹åŒ–**ï¼šå­˜åœ¨ä¸€äº›éªŒè¯è­¦å‘Šï¼Œä½†ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
2. **æ™ºèƒ½ä½“APIæ–‡ä»¶ä¸Šä¼ **ï¼šéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶æ™ºè°±AIçš„æ–‡ä»¶ä¸Šä¼ è¦æ±‚
3. **ç±»å‹é”™è¯¯**ï¼šä»£ç ä¸­æœ‰ä¸€äº›ç±»å‹æ£€æŸ¥è­¦å‘Šï¼Œä½†ä¸å½±å“è¿è¡Œ

## å»ºè®®

### çŸ­æœŸå»ºè®®
1. ç»§ç»­ä½¿ç”¨å½“å‰çš„å›é€€æœºåˆ¶ï¼Œç¡®ä¿åŠŸèƒ½ç¨³å®šæ€§
2. ç›‘æ§APIè°ƒç”¨æˆåŠŸç‡å’Œå“åº”æ—¶é—´
3. æ ¹æ®éœ€è¦è°ƒæ•´æ¨¡å‹å‚æ•°ï¼ˆtemperatureã€max_tokensç­‰ï¼‰

### é•¿æœŸå»ºè®®
1. æ·±å…¥ç ”ç©¶æ™ºè°±AIæ™ºèƒ½ä½“APIçš„æ­£ç¡®ä½¿ç”¨æ–¹æ³•
2. å®ç°æ›´ç²¾ç»†çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
3. æ·»åŠ APIè°ƒç”¨ç»Ÿè®¡å’Œç›‘æ§åŠŸèƒ½
4. è€ƒè™‘æ”¯æŒæ›´å¤šæ™ºè°±AIæ¨¡å‹å’ŒåŠŸèƒ½

## ç»“è®º

é€šè¿‡å®ç°APIå›é€€æœºåˆ¶ï¼ŒæˆåŠŸè§£å†³äº†æ™ºèƒ½ä½“å¯¹è¯çš„JSONå‚æ•°é”™è¯¯é—®é¢˜ã€‚ç³»ç»Ÿç°åœ¨èƒ½å¤Ÿï¼š
- ç¨³å®šåœ°è¿›è¡Œä¸­è‹±æ–‡ç¿»è¯‘
- è‡ªåŠ¨å¤„ç†APIå¤±è´¥æƒ…å†µ
- æä¾›ç»Ÿä¸€çš„å“åº”æ ¼å¼
- ä¿æŒè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

é—®é¢˜å·²åŸºæœ¬è§£å†³ï¼Œç³»ç»Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚